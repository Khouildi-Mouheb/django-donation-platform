<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>DÃ©tails de la proposition</title>

    <!-- âœ… Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container mt-4">

  <h2 class="fw-bold mb-3">Proposition #{{ proposition.id }} - {{ proposition.type_materiel }}</h2>

  <div class="card shadow-sm mb-4">
    <div class="card-body">

      <p><strong>Donateur :</strong> {{ proposition.participant_donateur }}</p>
      <p><strong>QuantitÃ© :</strong> {{ proposition.quantite }}</p>
      <p><strong>Ã‰tat :</strong> {{ proposition.get_etat_display }}</p>
      <p><strong>Description :</strong> {{ proposition.description }}</p>

      <p>
        <strong>Adresse ramassage :</strong>
        {{ proposition.adresse_ramassage }}, {{ proposition.ville }} {{ proposition.code_postal }}
      </p>

      <p><strong>DisponibilitÃ© :</strong> {{ proposition.disponibilite_ramassage }}</p>
      <p><strong>Statut :</strong> {{ proposition.get_statut_display }}</p>

      {% if proposition.photos %}
        <img src="{{ proposition.photos.url }}" class="img-fluid rounded mt-3" style="max-width:300px;" alt="Photo du don">
      {% endif %}

    </div>
  </div>

  <!-- Actions selon statut -->
  {% if proposition.statut == "en_attente" %}
    <div class="card shadow-sm p-3">

      <form method="post" action="{% url 'traiter_proposition' proposition.id %}">
        {% csrf_token %}

        <button type="submit" name="action" value="valider" class="btn btn-success">âœ” Valider</button>

        <textarea name="raison_refus" class="form-control mt-3" placeholder="Raison du refus"></textarea>

        <button type="submit" name="action" value="refuser" class="btn btn-danger mt-3">âœ– Refuser</button>
      </form>

    </div>

  {% else %}
    <div class="alert alert-secondary">
      <em>DÃ©jÃ  traitÃ© par {{ proposition.membre_validateur }}</em>
    </div>

    {% if proposition.statut == "validee" and not proposition.transporteur_assignee %}
      <a href="{% url 'assign_transporteur' proposition.id %}" class="btn btn-primary mb-3">
        ðŸšš Assigner un transporteur
      </a>

    {% elif proposition.transporteur_assignee %}
      <div class="alert alert-info">
        <strong>Transporteur assignÃ© :</strong> {{ proposition.transporteur_assignee }}
      </div>
    {% endif %}
  {% endif %}

  {% if user.user_type == "membre" and proposition.statut in "validee terminee_donateur terminee_transporteur" %}
    <a href="{% url 'ajouter_au_stock' proposition.id %}" class="btn btn-warning">
      ðŸ“¦ Ajouter au stock
    </a>
  {% endif %}

</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
